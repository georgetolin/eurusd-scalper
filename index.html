<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScorpXGT Forex & Gold Scalping Calculator</title>
  <meta name="description" content="AI-powered Forex scalping assistant with real data and technical indicators">
  
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --text: #e5e7eb;
      --text-muted: #94a3b8;
      --accent: #22c55e;
      --accent-hover: #16a34a;
      --danger: #ef4444;
      --warning: #eab308;
      --info: #3b82f6;
      --border: rgba(255, 255, 255, 0.1);
      --border-light: rgba(255, 255, 255, 0.05);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --radius: 12px;
      --transition: all 0.2s ease;
      --ai-buy: #10b981;
      --ai-sell: #ef4444;
      --ai-neutral: #6b7280;
      --api-blue: #1e40af;
      --api-green: #059669;
    }

    [data-theme="light"] {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --accent: #16a34a;
      --accent-hover: #15803d;
      --danger: #dc2626;
      --warning: #ca8a04;
      --info: #2563eb;
      --border: rgba(0, 0, 0, 0.1);
      --border-light: rgba(0, 0, 0, 0.05);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
      --ai-buy: #059669;
      --ai-sell: #dc2626;
      --ai-neutral: #9ca3af;
      --api-blue: #1d4ed8;
      --api-green: #047857;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 1600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 24px;
    }

    @media (max-width: 1200px) {
      .app {
        grid-template-columns: 1fr;
        max-width: 1000px;
      }
      
      .chart-container {
        order: -1;
        margin-bottom: 24px;
      }
    }

    .main-container {
      display: grid;
      grid-template-rows: auto auto;
      gap: 24px;
    }

    @media (max-width: 768px) {
      .main-container {
        grid-template-rows: auto;
      }
      
      .app {
        padding: 10px;
        gap: 16px;
      }
    }

    .calculator-container, .ai-assistant-container {
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    @media (max-width: 768px) {
      .calculator-container, .ai-assistant-container {
        padding: 20px;
      }
    }

    .ai-assistant-container {
      background: linear-gradient(135deg, rgba(30, 64, 175, 0.05), rgba(34, 197, 94, 0.02));
      border-left: 4px solid var(--api-blue);
    }

    .chart-container {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      min-height: 500px;
    }

    .header {
      margin-bottom: 30px;
    }

    @media (max-width: 768px) {
      .header {
        margin-bottom: 20px;
      }
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 15px;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 6px;
      background: linear-gradient(135deg, var(--accent), var(--api-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      word-break: break-word;
    }

    @media (max-width: 640px) {
      h1 {
        font-size: 1.5rem;
      }
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.95rem;
      max-width: 700px;
    }

    .api-badge {
      background: linear-gradient(135deg, var(--api-blue), var(--api-green));
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-left: 10px;
    }

    @media (max-width: 640px) {
      .api-badge {
        display: block;
        margin: 8px 0 0 0;
        width: fit-content;
      }
    }

    .theme-toggle {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      white-space: nowrap;
    }

    .theme-toggle:hover {
      background: var(--border-light);
      border-color: var(--accent);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 10px;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 10px 20px;
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      border-radius: 8px;
      transition: var(--transition);
      white-space: nowrap;
    }

    @media (max-width: 640px) {
      .tab-btn {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      
      .tabs {
        justify-content: center;
      }
    }

    .tab-btn.active {
      background: var(--api-blue);
      color: white;
    }

    .tab-btn:hover:not(.active) {
      background: var(--border-light);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* API Data Display */
    .api-data-container {
      background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(5, 150, 105, 0.05));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin: 20px 0;
      overflow: hidden;
    }

    @media (max-width: 768px) {
      .api-data-container {
        padding: 15px;
      }
    }

    .api-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .api-title {
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .api-logo {
      font-weight: 700;
      background: linear-gradient(135deg, var(--api-blue), var(--api-green));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .refresh-btn {
      background: var(--api-blue);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      white-space: nowrap;
    }

    .refresh-btn:hover {
      background: #1e40af;
      transform: translateY(-1px);
    }

    .refresh-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .api-data-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    @media (max-width: 1024px) {
      .api-data-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 640px) {
      .api-data-grid {
        grid-template-columns: 1fr;
      }
    }

    .api-data-item {
      background: rgba(255, 255, 255, 0.03);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
      min-width: 0;
      overflow: hidden;
    }

    .api-data-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 5px;
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .api-data-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text);
      overflow: hidden;
      text-overflow: ellipsis;
      word-break: break-all;
    }

    .api-data-change {
      font-size: 0.9rem;
      font-weight: 600;
      margin-top: 5px;
    }

    .positive {
      color: var(--accent);
    }

    .negative {
      color: var(--danger);
    }

    /* AI Assistant Specific Styles */
    .ai-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .ai-title {
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .ai-icon {
      font-size: 1.6rem;
    }

    .confidence-meter {
      width: 100%;
      height: 20px;
      background: var(--border);
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
      position: relative;
    }

    .confidence-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--danger), var(--warning), var(--accent));
      border-radius: 10px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .confidence-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 5px;
      flex-wrap: wrap;
    }

    .confidence-value {
      position: absolute;
      right: 10px;
      top: 0;
      height: 100%;
      display: flex;
      align-items: center;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .ai-signal {
      padding: 20px;
      border-radius: var(--radius);
      margin: 20px 0;
      text-align: center;
      display: none;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
      100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    .ai-signal.buy {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      border: 2px solid var(--ai-buy);
      display: block;
    }

    .ai-signal.sell {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      border: 2px solid var(--ai-sell);
      display: block;
    }

    .ai-signal.no-trade {
      background: linear-gradient(135deg, rgba(107, 114, 128, 0.2), rgba(107, 114, 128, 0.1));
      border: 2px solid var(--ai-neutral);
      display: block;
    }

    .signal-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .signal-buy { color: var(--ai-buy); }
    .signal-sell { color: var(--ai-sell); }
    .signal-neutral { color: var(--ai-neutral); }

    .ai-parameters {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .ai-parameters {
        grid-template-columns: 1fr;
      }
    }

    .param-group {
      background: var(--border-light);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .param-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 5px;
      display: block;
    }

    .param-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
    }

    .param-value.buy { color: var(--ai-buy); }
    .param-value.sell { color: var(--ai-sell); }

    .ai-results {
      background: var(--border-light);
      padding: 20px;
      border-radius: var(--radius);
      margin-top: 20px;
      border: 1px solid var(--border);
    }

    .ai-result-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    @media (max-width: 768px) {
      .ai-result-grid {
        grid-template-columns: 1fr;
      }
    }

    .ai-result-item {
      padding: 15px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .ai-result-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 5px;
      display: block;
    }

    .ai-result-value {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .generate-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, var(--api-blue), var(--accent));
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      transition: var(--transition);
    }

    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(30, 64, 175, 0.3);
    }

    .generate-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .ai-status {
      padding: 12px;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 0.9rem;
      display: none;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .ai-status.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      color: var(--accent);
      display: block;
    }

    .ai-status.warning {
      background: rgba(234, 179, 8, 0.1);
      border: 1px solid rgba(234, 179, 8, 0.2);
      color: var(--warning);
      display: block;
    }

    .ai-status.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--danger);
      display: block;
    }

    .ai-status.info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      color: var(--info);
      display: block;
    }

    /* Calculator styles */
    .currency-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
    }

    .currency-badge {
      background: var(--border);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      border: 1px solid transparent;
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
    }

    .currency-badge:hover {
      background: var(--border-light);
      border-color: var(--accent);
    }

    .currency-badge.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .currency-badge.xau {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .required::after {
      content: "*";
      color: var(--danger);
      margin-left: 2px;
    }

    input, select {
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      font-size: 1rem;
      transition: var(--transition);
      width: 100%;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }

    input::placeholder {
      color: var(--text-muted);
      opacity: 0.7;
    }

    .currency-info {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
      padding: 12px;
      background: var(--border-light);
      border-radius: 8px;
      font-size: 0.875rem;
      flex-wrap: wrap;
    }

    @media (max-width: 640px) {
      .currency-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }

    .currency-info .pip {
      font-weight: 600;
      color: var(--accent);
    }

    .currency-info .spread {
      font-weight: 600;
      color: var(--warning);
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 32px;
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .actions {
        margin-top: 24px;
      }
    }

    button {
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    @media (max-width: 640px) {
      button {
        padding: 10px 16px;
        font-size: 0.85rem;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .actions button {
        width: 100%;
      }
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      flex: 1;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border-light);
      border-color: var(--text-muted);
    }

    .btn-chart {
      background: var(--info);
      color: white;
      margin-top: 10px;
    }

    .btn-chart:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }

    .result {
      margin-top: 32px;
      padding: 24px;
      background: var(--border-light);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .result.show {
      display: block;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-top: 20px;
    }

    @media (max-width: 1024px) {
      .result-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 640px) {
      .result-grid {
        grid-template-columns: 1fr;
      }
    }

    .result-item {
      background: rgba(255, 255, 255, 0.03);
      padding: 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .result-item h3 {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .result-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent);
    }

    .status {
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      font-size: 0.95rem;
      display: none;
    }

    .status.show {
      display: block;
    }

    .status.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      color: var(--accent);
    }

    .status.warning {
      background: rgba(234, 179, 8, 0.1);
      border: 1px solid rgba(234, 179, 8, 0.2);
      color: var(--warning);
    }

    .status.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .footer {
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .tip {
      background: rgba(34, 197, 94, 0.05);
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid var(--accent);
    }

    .tip strong {
      color: var(--accent);
    }

    .input-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
      opacity: 0.8;
    }

    .currency-selector {
      margin-bottom: 20px;
    }

    .currency-selector label {
      margin-bottom: 10px;
      display: block;
    }

    .selected-currency {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--border-light);
      border-radius: 8px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .selected-currency .symbol {
      font-weight: 700;
      font-size: 1.2rem;
    }

    .selected-currency .name {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Chart Section */
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
      gap: 10px;
    }

    .chart-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .chart-timeframe {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .timeframe-btn {
      padding: 6px 12px;
      background: var(--border);
      border: none;
      border-radius: 6px;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.8rem;
      transition: var(--transition);
    }

    .timeframe-btn.active {
      background: var(--info);
      color: white;
    }

    .tradingview-widget {
      width: 100%;
      height: 400px;
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 15px;
      min-height: 300px;
    }

    .price-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--border-light);
      border-radius: var(--radius);
      margin-top: 15px;
      font-size: 0.9rem;
      flex-wrap: wrap;
      gap: 10px;
    }

    .price-change {
      font-weight: 600;
    }

    .price-change.positive {
      color: var(--accent);
    }

    .price-change.negative {
      color: var(--danger);
    }

    .chart-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .chart-type-btn {
      padding: 8px 16px;
      background: var(--border);
      border: none;
      border-radius: 6px;
      color: var(--text);
      cursor: pointer;
      font-size: 0.85rem;
      transition: var(--transition);
    }

    .chart-type-btn.active {
      background: var(--info);
      color: white;
    }

    .sync-notice {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 10px;
      text-align: center;
      padding: 8px;
      background: var(--border-light);
      border-radius: 6px;
    }

    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .quick-actions {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .quick-actions {
        grid-template-columns: 1fr;
      }
    }

    .quick-btn {
      padding: 10px;
      background: var(--border);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
      font-size: 0.85rem;
      text-align: center;
      transition: var(--transition);
    }

    .quick-btn:hover {
      background: var(--border-light);
      border-color: var(--accent);
    }

    /* Apply AI Signal Button */
    .apply-signal-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, var(--ai-buy), var(--api-blue));
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: var(--transition);
    }

    .apply-signal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    .apply-signal-btn.sell {
      background: linear-gradient(135deg, var(--ai-sell), #f97316);
    }

    .apply-signal-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Loading States */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--api-blue);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--text-muted);
      font-style: italic;
    }

    /* Technical Indicators */
    .indicators-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .indicator-item {
      background: var(--border-light);
      padding: 10px;
      border-radius: 6px;
      text-align: center;
    }

    .indicator-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .indicator-value {
      font-size: 0.9rem;
      font-weight: 600;
    }

    /* New Trade Direction Styles */
    .trade-direction {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 8px;
      background: var(--border-light);
      align-items: center;
      flex-wrap: wrap;
    }

    .trade-direction-label {
      font-weight: 600;
      color: var(--text-muted);
    }

    .trade-direction-value {
      font-weight: 700;
      font-size: 1.1rem;
      padding: 5px 15px;
      border-radius: 20px;
    }

    .trade-direction-value.long {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      color: var(--ai-buy);
      border: 2px solid var(--ai-buy);
    }

    .trade-direction-value.short {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      color: var(--ai-sell);
      border: 2px solid var(--ai-sell);
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .result-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text);
    }

    .result-subtitle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
      flex-wrap: wrap;
    }

    .trade-icon {
      font-size: 1.2rem;
    }

    .trade-icon.long {
      color: var(--ai-buy);
    }

    .trade-icon.short {
      color: var(--ai-sell);
    }

    .direction-badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 1.1rem;
      margin: 10px 0;
    }

    .direction-badge.long {
      background: linear-gradient(135deg, var(--ai-buy), #059669);
      color: white;
    }

    .direction-badge.short {
      background: linear-gradient(135deg, var(--ai-sell), #dc2626);
      color: white;
    }

    .pip-arrows {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(30, 64, 175, 0.05), rgba(34, 197, 94, 0.02));
      border-radius: var(--radius);
      border: 1px solid var(--border);
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .pip-arrows {
        gap: 20px;
      }
    }

    .pip-arrow {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      min-width: 80px;
    }

    .arrow {
      font-size: 2.5rem;
      line-height: 1;
    }

    .arrow.up {
      color: var(--ai-buy);
    }

    .arrow.down {
      color: var(--ai-sell);
    }

    .arrow-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .pip-count {
      font-weight: 700;
      font-size: 1.5rem;
    }

    /* Enhanced result items with direction context */
    .result-item.stop-loss {
      border-left: 4px solid var(--danger);
    }

    .result-item.take-profit {
      border-left: 4px solid var(--accent);
    }

    .result-item.risk-reward {
      border-left: 4px solid var(--warning);
    }

    .result-item.position-size {
      border-left: 4px solid var(--info);
    }

    .result-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 5px;
      font-style: italic;
    }

    .direction-indicator {
      grid-column: span 3;
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(34, 197, 94, 0.05));
    }

    @media (max-width: 1024px) {
      .direction-indicator {
        grid-column: span 2;
      }
    }

    @media (max-width: 640px) {
      .direction-indicator {
        grid-column: span 1;
      }
    }

    /* Mobile-specific fixes */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .calculator-container, .ai-assistant-container {
        padding: 15px;
      }
      
      .result-grid, .ai-parameters, .api-data-grid {
        grid-template-columns: 1fr;
      }
      
      .api-data-item, .result-item, .param-group {
        padding: 12px;
      }
      
      h1 {
        font-size: 1.3rem;
      }
      
      .ai-title {
        font-size: 1.2rem;
      }
      
      .confidence-labels {
        font-size: 0.7rem;
      }
    }

    /* Ensure content doesn't overflow */
    .tab-content {
      overflow-x: hidden;
    }

    /* Improve touch targets on mobile */
    @media (max-width: 768px) {
      input, select, button {
        min-height: 44px; /* Minimum touch target size */
      }
    }
  </style>

  <!-- TradingView Widget -->
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
</head>
<body data-theme="dark">
  <div class="app">
    <!-- Left Column: Main Content -->
    <div class="main-container">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="calculator">Position Calculator</button>
        <button class="tab-btn" data-tab="ai-assistant">AI Trading Assistant</button>
        <button class="tab-btn" data-tab="market-data">Market Data</button>
      </div>

      <!-- Calculator Tab -->
      <div class="tab-content active" id="calculator-tab">
        <div class="calculator-container">
          <div class="header">
            <div class="top-bar">
              <div>
                <h1>ScorpXGT Forex & Gold Scalping Calculator <span class="api-badge">Trading API</span></h1>
                <p class="subtitle">Professional position sizing calculator with real-time financial data from comprehensive API.</p>
              </div>
              <button class="theme-toggle" id="themeBtn">
                <span class="theme-icon">ðŸŒ™</span>
                <span class="theme-text">Dark Mode</span>
              </button>
            </div>

            <div class="currency-badges">
              <div class="currency-badge active" data-currency="EURUSD">EUR/USD</div>
              <div class="currency-badge" data-currency="GBPUSD">GBP/USD</div>
              <div class="currency-badge" data-currency="USDJPY">USD/JPY</div>
              <div class="currency-badge" data-currency="AUDUSD">AUD/USD</div>
              <div class="currency-badge" data-currency="USDCAD">USD/CAD</div>
              <div class="currency-badge" data-currency="USDCHF">USD/CHF</div>
              <div class="currency-badge xau" data-currency="XAUUSD">XAU/USD</div>
            </div>
          </div>

          <div class="currency-selector">
            <label>Selected Instrument:</label>
            <div class="selected-currency" id="selectedCurrency">
              <span class="symbol">EUR/USD</span>
              <span class="name">Euro vs US Dollar</span>
            </div>
          </div>

          <!-- Trade direction indicator -->
          <div class="trade-direction" id="tradeDirection" style="display: none;">
            <span class="trade-direction-label">Trade Direction:</span>
            <span class="trade-direction-value" id="directionValue">â€”</span>
            <span class="trade-direction-details" id="directionDetails"></span>
          </div>

          <div class="grid">
            <div class="input-group">
              <label for="entry" class="required">Entry Price</label>
              <input 
                type="number" 
                id="entry" 
                step="0.00001" 
                placeholder="e.g., 1.07450"
                min="0.5"
                max="2"
                value="1.14996"
              >
              <div class="input-hint">Current market price for selected instrument</div>
            </div>
            
            <div class="input-group">
              <label for="stop" class="required">Stop Loss Price</label>
              <input 
                type="number" 
                id="stop" 
                step="0.00001" 
                placeholder="e.g., 1.07350"
                value="1.14774"
              >
              <div class="input-hint">Price where you'll exit to limit losses</div>
            </div>
            
            <div class="input-group">
              <label for="take" class="required">Take Profit Price</label>
              <input 
                type="number" 
                id="take" 
                step="0.00001" 
                placeholder="e.g., 1.07600"
                value="1.14999"
              >
              <div class="input-hint">Price where you'll take profits</div>
            </div>
            
            <div class="input-group">
              <label for="balance" class="required">Account Balance (USD)</label>
              <input 
                type="number" 
                id="balance" 
                step="0.01" 
                placeholder="e.g., 10000"
                min="100"
                value="10000"
              >
              <div class="input-hint">Your trading account balance in USD</div>
            </div>
            
            <div class="input-group">
              <label for="riskPct" class="required">Risk Per Trade (%)</label>
              <input 
                type="number" 
                id="riskPct" 
                step="0.01" 
                placeholder="e.g., 0.5"
                min="0.01"
                max="5"
                value="0.5"
              >
              <div class="input-hint">Recommended: 0.5% - 2% of account balance</div>
            </div>
            
            <div class="input-group">
              <label for="pipValue">Position Size Type</label>
              <select id="pipValue">
                <option value="10" selected>Standard (1.0 lot = $10/pip)</option>
                <option value="1">Mini (0.1 lot = $1/pip)</option>
                <option value="0.1">Micro (0.01 lot = $0.10/pip)</option>
              </select>
              <div class="input-hint">Select based on your broker account type</div>
            </div>
          </div>

          <div class="currency-info" id="currencyInfo">
            <div><span class="pip">1 pip = 0.0001</span> (4th decimal)</div>
            <div>Typical spread: <span class="spread">0.6-1.2 pips</span></div>
            <div>Trading hours: London-NY overlap (13:00-16:00 GMT)</div>
          </div>

          <div class="actions">
            <button class="btn-primary" id="calcBtn">
              <span>ðŸ“Š Calculate Position Size</span>
            </button>
            <button class="btn-secondary" id="resetBtn">
              <span>ðŸ”„ Reset All</span>
            </button>
            <button class="btn-chart" id="syncChartBtn">
              <span>ðŸ“ˆ Sync with Chart</span>
            </button>
            <button class="btn-chart" id="syncMarketDataBtn" style="background: var(--api-blue);">
              <span>ðŸ“Š Use Market Data</span>
            </button>
          </div>

          <div class="result" id="result">
            <div class="result-header">
              <div>
                <div class="result-title">Results for <span id="resultCurrency">EUR/USD</span></div>
                <div class="result-subtitle">
                  <span class="trade-icon" id="tradeIcon">â€”</span>
                  <span id="tradeType">No Trade Calculated</span>
                </div>
              </div>
              <div class="direction-badge" id="directionBadge" style="display: none;">â€”</div>
            </div>
            
            <!-- Visual pip arrows -->
            <div class="pip-arrows" id="pipArrows" style="display: none;">
              <div class="pip-arrow">
                <div class="arrow up" id="profitArrow">â†‘</div>
                <div class="arrow-label">Take Profit</div>
                <div class="pip-count" id="profitPips">15.0</div>
              </div>
              <div class="pip-arrow">
                <div class="arrow down" id="lossArrow">â†“</div>
                <div class="arrow-label">Stop Loss</div>
                <div class="pip-count" id="lossPips">7.5</div>
              </div>
            </div>

            <div class="result-grid">
              <div class="result-item stop-loss">
                <h3>Pips to Stop Loss</h3>
                <div class="result-value" id="pipsStop">â€”</div>
                <div class="result-hint" id="stopHint"></div>
              </div>
              <div class="result-item take-profit">
                <h3>Pips to Take Profit</h3>
                <div class="result-value" id="pipsTake">â€”</div>
                <div class="result-hint" id="takeHint"></div>
              </div>
              <div class="result-item risk-reward">
                <h3>Risk : Reward Ratio</h3>
                <div class="result-value" id="rr">â€”</div>
                <div class="result-hint">1:2 ratio recommended</div>
              </div>
              <div class="result-item">
                <h3>Risk Amount (USD)</h3>
                <div class="result-value" id="riskUsd">â€”</div>
              </div>
              <div class="result-item position-size">
                <h3>Position Size (Lots)</h3>
                <div class="result-value" id="lots">â€”</div>
              </div>
              <div class="result-item">
                <h3>Position Units</h3>
                <div class="result-value" id="units">â€”</div>
              </div>
              
              <!-- Trade Direction Indicator -->
              <div class="result-item direction-indicator" id="directionIndicator" style="display: none;">
                <h3>Trade Setup</h3>
                <div id="directionText" style="font-size: 1.1rem; margin: 10px 0;"></div>
                <div id="directionExplanation" style="font-size: 0.9rem; color: var(--text-muted);"></div>
              </div>
            </div>
          </div>

          <div class="status" id="status"></div>

          <div class="footer">
            <div class="tip">
              <p><strong>ðŸ’¡ Trade Direction Indicators:</strong></p>
              <p><strong>LONG (Buy):</strong> Green indicator appears when Take Profit > Entry > Stop Loss<br>
              <strong>SHORT (Sell):</strong> Red indicator appears when Stop Loss > Entry > Take Profit<br>
              Arrows show profit (up) and loss (down) directions with pip counts</p>
            </div>
            <p style="margin-top: 16px; font-size: 0.8rem; opacity: 0.7;">
              Powered by Comprehensive Financial API | Real-time forex data and technical indicators<br>
              Disclaimer: This tool is for educational purposes. Trading involves risk of loss.
            </p>
          </div>
        </div>
      </div>

      <!-- AI Assistant Tab -->
      <div class="tab-content" id="ai-assistant-tab">
        <div class="ai-assistant-container">
          <div class="ai-header">
            <div class="ai-title">
              <span class="ai-icon">ðŸ¤–</span>
              AI Trading Assistant
            </div>
            <button class="theme-toggle" id="aiThemeBtn">
              <span class="theme-icon">ðŸŒ™</span>
              <span class="theme-text">Dark Mode</span>
            </button>
          </div>

          <!-- Operating Mode Toggles -->
          <div class="mode-toggles">
            <div class="mode-toggle-group">
              <label class="mode-label">
                <input type="checkbox" id="noHallucinationMode" checked>
                <span class="mode-text">No-Hallucination Mode</span>
                <span class="mode-badge active">ACTIVE</span>
              </label>
              <label class="mode-label">
                <input type="checkbox" id="backtestMode">
                <span class="mode-text">Backtest Mode</span>
                <span class="mode-badge">INACTIVE</span>
              </label>
            </div>
          </div>

          <div class="api-data-container">
            <div class="api-header">
              <div class="api-title">
                <span class="api-logo">Financial API</span>
                <span>Real-Time Market Data</span>
                <span class="data-type-badge" id="dataTypeBadge">LIVE</span>
              </div>
              <div class="api-time">
                <span class="time-label">Last Update:</span>
                <span class="time-value" id="lastUpdateTime">Loading...</span>
              </div>
            </div>
            
            <div class="api-data-grid">
              <div class="api-data-item">
                <span class="api-data-label">Symbol</span>
                <select class="api-data-value symbol-select" id="aiSymbolSelect">
                  <option value="EURUSD" selected>EUR/USD</option>
                  <option value="GBPUSD">GBP/USD</option>
                  <option value="USDJPY">USD/JPY</option>
                  <option value="AUDUSD">AUD/USD</option>
                  <option value="USDCAD">USD/CAD</option>
                  <option value="USDCHF">USD/CHF</option>
                  <option value="XAUUSD">XAU/USD</option>
                </select>
                <span class="api-data-label">Asset Class</span>
                <span class="api-data-value" id="assetClass">FOREX</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">Current Price</span>
                <span class="api-data-value" id="apiCurrentPrice">1.14996</span>
                <span class="api-data-label">Bid/Ask</span>
                <span class="api-data-value" id="apiBidAsk">1.14991 / 1.15001</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">Spread</span>
                <span class="api-data-value" id="apiSpread">1.0 pips</span>
                <span class="api-data-label">Max Allowed</span>
                <span class="api-data-value" id="maxSpreadAllowed">1.5 pips</span>
              </div>
            </div>

            <!-- Multi-Timeframe Section -->
            <div class="mtf-section">
              <h4 style="margin: 15px 0 10px 0;">Multi-Timeframe Analysis</h4>
              <div class="api-data-grid">
                <div class="api-data-item">
                  <span class="api-data-label">Primary TF (M5)</span>
                  <span class="api-data-value" id="primaryTimeframe">M5</span>
                  <span class="api-data-label">Market Structure</span>
                  <span class="api-data-value" id="marketStructure">BULLISH</span>
                </div>
                <div class="api-data-item">
                  <span class="api-data-label">Higher TF (M15)</span>
                  <span class="api-data-value" id="htfTimeframe">M15</span>
                  <span class="api-data-label">HTF Structure</span>
                  <span class="api-data-value" id="htfMarketStructure">BULLISH</span>
                </div>
                <div class="api-data-item">
                  <span class="api-data-label">MTF Alignment</span>
                  <span class="api-data-value" id="mtfAlignment">ALIGNED</span>
                  <span class="api-data-label">Session</span>
                  <span class="api-data-value" id="currentSession">London</span>
                </div>
              </div>
            </div>

            <!-- Technical Indicators -->
            <h4 style="margin: 15px 0 10px 0;">Technical Indicators</h4>
            <div class="indicators-grid expanded">
              <div class="indicator-item">
                <span class="indicator-label">EMA20</span>
                <span class="indicator-value" id="indicatorEMA20">1.14850</span>
              </div>
              <div class="indicator-item">
                <span class="indicator-label">EMA50</span>
                <span class="indicator-value" id="indicatorEMA50">1.14780</span>
              </div>
              <div class="indicator-item">
                <span class="indicator-label">RSI14</span>
                <span class="indicator-value" id="indicatorRSI14">58.2</span>
              </div>
              <div class="indicator-item">
                <span class="indicator-label">ATR14</span>
                <span class="indicator-value" id="indicatorATR14">0.00075</span>
              </div>
              <div class="indicator-item">
                <span class="indicator-label">Swing High</span>
                <span class="indicator-value" id="swingHigh">1.15025</span>
              </div>
              <div class="indicator-item">
                <span class="indicator-label">Swing Low</span>
                <span class="indicator-value" id="swingLow">1.14750</span>
              </div>
              <div class="indicator-item">
                <span class="indicator-label">HTF EMA20</span>
                <span class="indicator-value" id="htfEMA20">1.14820</span>
              </div>
              <div class="indicator-item">
                <span class="indicator-label">HTF EMA50</span>
                <span class="indicator-value" id="htfEMA50">1.14760</span>
              </div>
            </div>
          </div>

          <!-- Account & Risk Parameters -->
          <div class="risk-parameters">
            <h4 style="margin: 0 0 15px 0;">Account & Risk Parameters</h4>
            <div class="ai-parameters expanded">
              <div class="param-group">
                <span class="param-label">Account Balance</span>
                <input type="number" class="param-input" id="aiAccountBalance" value="10000" min="100" step="100">
                <span class="param-hint">USD</span>
              </div>
              <div class="param-group">
                <span class="param-label">Risk %</span>
                <input type="number" class="param-input" id="aiRiskPercent" value="0.5" min="0.1" max="5" step="0.1">
                <span class="param-hint">%</span>
              </div>
              <div class="param-group">
                <span class="param-label">Max Dollar Risk</span>
                <span class="param-value" id="maxDollarRisk">$50.00</span>
              </div>
              <div class="param-group">
                <span class="param-label">Min R:R</span>
                <input type="number" class="param-input" id="minRR" value="1.2" min="1.0" max="3.0" step="0.1">
                <span class="param-hint">ratio</span>
              </div>
              <div class="param-group">
                <span class="param-label">Confidence Threshold</span>
                <input type="number" class="param-input" id="confidenceThreshold" value="70" min="50" max="90" step="1">
                <span class="param-hint">%</span>
              </div>
              <div class="param-group">
                <span class="param-label">News Risk</span>
                <select class="param-select" id="newsRisk">
                  <option value="LOW" selected>LOW</option>
                  <option value="MEDIUM">MEDIUM</option>
                  <option value="HIGH">HIGH</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Confidence Meter -->
          <div class="confidence-section">
            <div class="confidence-header">
              <span class="confidence-label">Confidence Score</span>
              <span class="confidence-threshold">Threshold: <span id="thresholdValue">70</span>%</span>
            </div>
            <div class="confidence-meter">
              <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
              <div class="confidence-value" id="confidenceValue">0%</div>
            </div>
            <div class="confidence-labels">
              <span>Low (0-49)</span>
              <span>Medium (50-69)</span>
              <span>High (70-89)</span>
              <span>Very High (90-100)</span>
            </div>
            
            <!-- Confidence Breakdown -->
            <div class="confidence-breakdown" id="confidenceBreakdown" style="display: none;">
              <div class="breakdown-item">
                <span class="breakdown-label">EMA Alignment:</span>
                <span class="breakdown-value" id="scoreEMA">0</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">Market Structure:</span>
                <span class="breakdown-value" id="scoreStructure">0</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">RSI Confirmation:</span>
                <span class="breakdown-value" id="scoreRSI">0</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">Pullback Quality:</span>
                <span class="breakdown-value" id="scorePullback">0</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">Spread Efficiency:</span>
                <span class="breakdown-value" id="scoreSpread">0</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">R:R Exceedance:</span>
                <span class="breakdown-value" id="scoreRR">0</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">MTF Alignment:</span>
                <span class="breakdown-value" id="scoreMTF">0</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">Session Penalty:</span>
                <span class="breakdown-value" id="scoreSession">0</span>
              </div>
            </div>
          </div>

          <!-- Data Status & Validation -->
          <div class="validation-section">
            <div class="validation-header">
              <h4>Data Validation</h4>
              <span class="validation-status" id="validationStatus" data-status="PENDING">PENDING</span>
            </div>
            <div class="validation-grid" id="validationGrid">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>

          <div class="ai-status" id="aiStatus"></div>

          <button class="generate-btn" id="generateSignalBtn">
            <span>âš¡ Generate AI Signal</span>
          </button>

          <!-- Data Status Display -->
          <div class="data-status" id="dataStatus" style="display: none;">
            <div class="status-item">
              <span class="status-label">Valid Data:</span>
              <span class="status-value" id="validDataStatus">NO</span>
            </div>
            <div class="status-item">
              <span class="status-label">Data Type:</span>
              <span class="status-value" id="dataTypeStatus">â€”</span>
            </div>
          </div>

          <!-- AI Signal Display -->
          <div class="ai-signal no-trade" id="aiSignal">
            <div class="signal-header">
              <span class="signal-icon" id="signalIcon">ðŸ“Š</span>
              <div class="signal-title-group">
                <div class="signal-title" id="signalTitle">No Signal Generated</div>
                <div class="signal-subtitle" id="signalSubtitle">Click "Generate AI Signal" to analyze the market</div>
              </div>
              <span class="signal-confidence" id="signalConfidence">â€”</span>
            </div>
            <div class="signal-details" id="signalDetails"></div>
          </div>

          <!-- Rejection Reasons (shown when NO TRADE) -->
          <div class="rejection-reasons" id="rejectionReasons" style="display: none;">
            <h4>Rejection Reasons</h4>
            <ul id="rejectionList">
              <!-- Will be populated by JavaScript -->
            </ul>
          </div>

          <!-- Trade Results (shown when BUY/SELL) -->
          <div class="ai-results" id="aiResults" style="display: none;">
            <div class="results-header">
              <h3>Trade Analysis Results</h3>
              <span class="results-confidence" id="resultsConfidence">â€”</span>
            </div>
            
            <div class="ai-result-grid expanded">
              <div class="ai-result-item">
                <span class="ai-result-label">Entry Price</span>
                <span class="ai-result-value" id="aiEntryPrice">â€”</span>
              </div>
              <div class="ai-result-item">
                <span class="ai-result-label">Stop Loss</span>
                <span class="ai-result-value" id="aiStopLoss">â€”</span>
              </div>
              <div class="ai-result-item">
                <span class="ai-result-label">Take Profit</span>
                <span class="ai-result-value" id="aiTakeProfit">â€”</span>
              </div>
              <div class="ai-result-item">
                <span class="ai-result-label">Risk:Reward</span>
                <span class="ai-result-value" id="aiRiskReward">â€”</span>
              </div>
              <div class="ai-result-item">
                <span class="ai-result-label">Stop Loss (Pips)</span>
                <span class="ai-result-value" id="aiStopLossPips">â€”</span>
              </div>
              <div class="ai-result-item">
                <span class="ai-result-label">Take Profit (Pips)</span>
                <span class="ai-result-value" id="aiTakeProfitPips">â€”</span>
              </div>
              <div class="ai-result-item">
                <span class="ai-result-label">Position Size (Lots)</span>
                <span class="ai-result-value" id="aiPositionSize">â€”</span>
              </div>
              <div class="ai-result-item">
                <span class="ai-result-label">Dollar Risk</span>
                <span class="ai-result-value" id="aiDollarRisk">â€”</span>
              </div>
            </div>

            <button class="apply-signal-btn" id="applySignalBtn">
              <span>ðŸ“‹ Apply to Calculator</span>
            </button>
          </div>

          <!-- Disclaimer -->
          <div class="disclaimer">
            <p><strong>DISCLAIMER:</strong> Automated market analysis only. Not financial advice.</p>
            <p style="font-size: 0.8rem; margin-top: 5px; opacity: 0.7;">
              Model: meta/llama-3.3-70b-instruct | API: Comprehensive Financial API<br>
              Backtest Compatible | No-Hallucination Mode: Enabled
            </p>
          </div>
        </div>
      </div>

      <!-- Market Data Tab -->
      <div class="tab-content" id="market-data-tab">
        <div class="calculator-container">
          <div class="header">
            <h1>Market Data Dashboard <span class="api-badge">Trading API</span></h1>
            <p class="subtitle">Real-time forex data, technical indicators, and market analysis from comprehensive API</p>
          </div>

          <div class="api-data-container" style="margin-top: 0;">
            <div class="api-header">
              <div class="api-title">
                <span class="api-logo">Financial API</span>
                <span>FX Real-Time Rates</span>
              </div>
              <div>
                <button class="refresh-btn" id="refreshAllData">
                  <span>ðŸ”„ Refresh All</span>
                </button>
                <button class="refresh-btn" style="background: var(--accent); margin-left: 10px;" id="autoRefreshToggle">
                  <span>â±ï¸ Auto Refresh: OFF</span>
                </button>
              </div>
            </div>

            <div class="currency-badges" style="margin: 15px 0;">
              <div class="currency-badge active" data-api-symbol="EURUSD">EUR/USD</div>
              <div class="currency-badge" data-api-symbol="GBPUSD">GBP/USD</div>
              <div class="currency-badge" data-api-symbol="USDJPY">USD/JPY</div>
              <div class="currency-badge" data-api-symbol="AUDUSD">AUD/USD</div>
              <div class="currency-badge" data-api-symbol="USDCAD">USD/CAD</div>
              <div class="currency-badge" data-api-symbol="USDCHF">USD/CHF</div>
              <div class="currency-badge xau" data-api-symbol="XAUUSD">XAU/USD</div>
            </div>

            <div class="api-data-grid">
              <div class="api-data-item">
                <span class="api-data-label">Current Price</span>
                <span class="api-data-value" id="marketCurrentPrice">1.14996</span>
                <span class="api-data-change positive">+0.02%</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">Open</span>
                <span class="api-data-value" id="marketOpen">1.14973</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">High</span>
                <span class="api-data-value" id="marketHigh">1.15025</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">Low</span>
                <span class="api-data-value" id="marketLow">1.14750</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">Previous Close</span>
                <span class="api-data-value" id="marketPreviousClose">1.14973</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">Change %</span>
                <span class="api-data-value" id="marketChangePercent">+0.02%</span>
              </div>
            </div>

            <h3 style="margin: 20px 0 10px 0;">Technical Indicators</h3>
            <div class="api-data-grid">
              <div class="api-data-item">
                <span class="api-data-label">EMA (20)</span>
                <span class="api-data-value" id="techEMA20">1.14850</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">EMA (50)</span>
                <span class="api-data-value" id="techEMA50">1.14780</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">RSI (14)</span>
                <span class="api-data-value" id="techRSI14">58.2</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">ATR (14)</span>
                <span class="api-data-value" id="techATR14">0.00075</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">MACD</span>
                <span class="api-data-value" id="techMACD">+0.00015</span>
              </div>
              <div class="api-data-item">
                <span class="api-data-label">Bollinger Bands</span>
                <span class="api-data-value" id="techBB">1.14600 - 1.15200</span>
              </div>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: var(--border-light); border-radius: 8px;">
              <h4 style="margin-bottom: 10px;">Market Sentiment</h4>
              <div style="display: flex; align-items: center; gap: 10px;">
                <div style="flex: 1; height: 10px; background: var(--border); border-radius: 5px; overflow: hidden;">
                  <div id="sentimentBar" style="height: 100%; background: linear-gradient(90deg, var(--danger), var(--warning), var(--accent)); width: 65%;"></div>
                </div>
                <span id="sentimentText" style="font-weight: 600; color: var(--accent);">Bullish</span>
              </div>
            </div>
          </div>

          <div class="footer">
            <div class="tip">
              <p><strong>ðŸ“Š Financial API Features:</strong></p>
              <p>â€¢ Real-time and historical forex data<br>
              â€¢ Comprehensive technical indicators (EMA, RSI, MACD, Bollinger Bands, etc.)<br>
              â€¢ Intraday, daily, weekly, and monthly data<br>
              â€¢ Exchange rate calculations<br>
              â€¢ Digital & physical currencies support</p>
            </div>
            <p style="margin-top: 16px; font-size: 0.8rem; opacity: 0.7;">
              API Key: d5ba5h1r01qq0hq2lge0d5ba5h1r01qq0hq2lgeg | Base URL: /api/v1<br>
              This is a comprehensive financial API with RESTful endpoints<br>
              Includes forex, stocks, commodities, and crypto data
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Chart -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">Live Chart</div>
        <div class="price-display" id="priceDisplay">
          <span id="currentPrice">EUR/USD: 1.14996</span>
          <span id="priceChange" class="price-change positive">+0.00023</span>
        </div>
      </div>

      <div class="chart-timeframe">
        <button class="timeframe-btn active" data-timeframe="5">5M</button>
        <button class="timeframe-btn" data-timeframe="15">15M</button>
        <button class="timeframe-btn" data-timeframe="60">1H</button>
        <button class="timeframe-btn" data-timeframe="240">4H</button>
        <button class="timeframe-btn" data-timeframe="D">D</button>
      </div>

      <div class="chart-controls">
        <button class="chart-type-btn active" data-chart-type="candles">Candles</button>
        <button class="chart-type-btn" data-chart-type="line">Line</button>
        <button class="chart-type-btn" data-chart-type="bars">Bars</button>
        <button class="chart-type-btn" data-chart-type="area">Area</button>
      </div>

      <div id="tradingview_chart" class="tradingview-widget"></div>

      <div class="sync-notice" id="syncNotice">
        Real-time data from Financial API. Click "Use Market Data" to populate calculator.
      </div>

      <div class="quick-actions">
        <button class="quick-btn" id="quickEntry">Set Entry from Data</button>
        <button class="quick-btn" id="quickStop">Set Stop from ATR</button>
        <button class="quick-btn" id="quickTake">Set TP from RR</button>
        <button class="quick-btn" id="updateFromMarket">Update All</button>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentTab = 'calculator';
    let isAutoRefreshEnabled = false;
    let autoRefreshInterval;
    let isGeneratingSignal = false;

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeTheme();
      initializeTabs();
      initializeCurrencySelection();
      initializeCalculator();
      initializeAIAssistant();
      initializeMarketData();
      initializeChart();
      setupEventListeners();
      
      // Initial calculation
      setTimeout(calculatePosition, 100);
      
      // Update last update time
      updateLastUpdateTime();
    });

    // Theme Management
    function initializeTheme() {
      const themeBtn = document.getElementById('themeBtn');
      const aiThemeBtn = document.getElementById('aiThemeBtn');
      const body = document.body;
      
      function toggleTheme() {
        const isDark = body.getAttribute('data-theme') === 'dark';
        const newTheme = isDark ? 'light' : 'dark';
        
        body.setAttribute('data-theme', newTheme);
        
        const icon = themeBtn.querySelector('.theme-icon');
        const text = themeBtn.querySelector('.theme-text');
        const aiIcon = aiThemeBtn.querySelector('.theme-icon');
        const aiText = aiThemeBtn.querySelector('.theme-text');
        
        icon.textContent = newTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
        text.textContent = newTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
        aiIcon.textContent = newTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
        aiText.textContent = newTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
        
        localStorage.setItem('scalping-calculator-theme', newTheme);
        
        // Update TradingView chart theme
        updateChartTheme();
      }
      
      themeBtn.addEventListener('click', toggleTheme);
      aiThemeBtn.addEventListener('click', toggleTheme);
      
      // Load saved theme
      const savedTheme = localStorage.getItem('scalping-calculator-theme');
      if (savedTheme) {
        body.setAttribute('data-theme', savedTheme);
        const icon = themeBtn.querySelector('.theme-icon');
        const text = themeBtn.querySelector('.theme-text');
        const aiIcon = aiThemeBtn.querySelector('.theme-icon');
        const aiText = aiThemeBtn.querySelector('.theme-text');
        
        icon.textContent = savedTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
        text.textContent = savedTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
        aiIcon.textContent = savedTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
        aiText.textContent = savedTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
      }
    }

    // Tab Management
    function initializeTabs() {
      const tabButtons = document.querySelectorAll('.tab-btn');
      
      tabButtons.forEach(tab => {
        tab.addEventListener('click', function(e) {
          const tabId = e.target.dataset.tab;
          
          // Don't do anything if clicking the same tab
          if (currentTab === tabId) return;
          
          // Update current tab
          currentTab = tabId;
          
          // Hide all tabs
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          
          // Show selected tab
          const tabElement = document.getElementById(`${tabId}-tab`);
          if (tabElement) {
            tabElement.classList.add('active');
          }
          
          // Update tab buttons
          tabButtons.forEach(btn => {
            btn.classList.remove('active');
          });
          
          e.target.classList.add('active');
          
          // Load data for the tab if needed
          if (tabId === 'market-data') {
            refreshMarketData();
          } else if (tabId === 'ai-assistant') {
            updateAIInterface();
          }
        });
      });
    }

    // Currency Selection
    function initializeCurrencySelection() {
      // Main calculator currency badges
      document.querySelectorAll('.currency-badge').forEach(badge => {
        badge.addEventListener('click', function(e) {
          const currency = e.target.dataset.currency;
          selectCurrency(currency);
        });
      });
      
      // Market data currency badges
      document.querySelectorAll('[data-api-symbol]').forEach(badge => {
        badge.addEventListener('click', function(e) {
          const symbol = e.target.dataset.apiSymbol;
          
          // Update active badge
          document.querySelectorAll('[data-api-symbol]').forEach(b => {
            b.classList.remove('active');
          });
          e.target.classList.add('active');
          
          // Update AI symbol select if needed
          const aiSelect = document.getElementById('aiSymbolSelect');
          if (aiSelect) {
            aiSelect.value = symbol;
          }
          
          // Refresh market data for new symbol
          refreshMarketDataForSymbol(symbol);
        });
      });
    }

    function selectCurrency(currency) {
      // Update active badge
      document.querySelectorAll('.currency-badge').forEach(b => {
        b.classList.remove('active');
      });
      document.querySelector(`[data-currency="${currency}"]`).classList.add('active');
      
      // Update selected currency display
      const selectedCurrency = document.getElementById('selectedCurrency');
      const resultCurrency = document.getElementById('resultCurrency');
      
      const currencyNames = {
        EURUSD: { symbol: 'EUR/USD', name: 'Euro vs US Dollar' },
        GBPUSD: { symbol: 'GBP/USD', name: 'British Pound vs US Dollar' },
        USDJPY: { symbol: 'USD/JPY', name: 'US Dollar vs Japanese Yen' },
        AUDUSD: { symbol: 'AUD/USD', name: 'Australian Dollar vs US Dollar' },
        USDCAD: { symbol: 'USD/CAD', name: 'US Dollar vs Canadian Dollar' },
        USDCHF: { symbol: 'USD/CHF', name: 'US Dollar vs Swiss Franc' },
        XAUUSD: { symbol: 'XAU/USD', name: 'Gold vs US Dollar' }
      };
      
      if (currencyNames[currency]) {
        selectedCurrency.innerHTML = `
          <span class="symbol">${currencyNames[currency].symbol}</span>
          <span class="name">${currencyNames[currency].name}</span>
        `;
        resultCurrency.textContent = currencyNames[currency].symbol;
      }
      
      // Update pip info
      updateCurrencyInfo(currency);
      
      // Update chart if needed
      updateChartSymbol(currency);
    }

    function updateCurrencyInfo(currency) {
      const currencyInfo = document.getElementById('currencyInfo');
      
      switch(currency) {
        case 'XAUUSD':
          currencyInfo.innerHTML = `
            <div><span class="pip">1 pip = $0.01</span> (2nd decimal)</div>
            <div>Typical spread: <span class="spread">0.3-0.8 pips</span></div>
            <div>Trading hours: 24/5 (highest liquidity London-NY)</div>
          `;
          break;
        case 'USDJPY':
          currencyInfo.innerHTML = `
            <div><span class="pip">1 pip = 0.01</span> (2nd decimal)</div>
            <div>Typical spread: <span class="spread">0.5-1.0 pips</span></div>
            <div>Trading hours: Tokyo-London overlap (00:00-08:00 GMT)</div>
          `;
          break;
        default:
          currencyInfo.innerHTML = `
            <div><span class="pip">1 pip = 0.0001</span> (4th decimal)</div>
            <div>Typical spread: <span class="spread">0.6-1.2 pips</span></div>
            <div>Trading hours: London-NY overlap (13:00-16:00 GMT)</div>
          `;
      }
    }

    // Calculator Functions
    function initializeCalculator() {
      // Calculate button
      document.getElementById('calcBtn').addEventListener('click', calculatePosition);
      
      // Reset button
      document.getElementById('resetBtn').addEventListener('click', resetCalculator);
      
      // Auto-calculate on Enter key in inputs
      const inputs = ['entry', 'stop', 'take', 'balance', 'riskPct'];
      inputs.forEach(id => {
        document.getElementById(id).addEventListener('keypress', function(e) {
          if (e.key === 'Enter') calculatePosition();
        });
      });
      
      // Sync buttons
      document.getElementById('syncChartBtn').addEventListener('click', syncWithChart);
      document.getElementById('syncMarketDataBtn').addEventListener('click', syncWithMarketData);
    }

    function calculatePosition() {
      // Get input values
      const entry = parseFloat(document.getElementById('entry').value);
      const stop = parseFloat(document.getElementById('stop').value);
      const take = parseFloat(document.getElementById('take').value);
      const balance = parseFloat(document.getElementById('balance').value);
      const riskPct = parseFloat(document.getElementById('riskPct').value);
      const pipValPerLot = parseFloat(document.getElementById('pipValue').value);
      
      // Validate inputs
      if (!entry || !stop || !take || !balance || !riskPct) {
        showStatus('Please fill in all required fields.', 'error');
        return;
      }
      
      if (entry <= 0 || stop <= 0 || take <= 0) {
        showStatus('Prices must be positive numbers.', 'error');
        return;
      }
      
      // Validate trade direction
      if ((take > entry && stop > entry) || (take < entry && stop < entry)) {
        showStatus('Stop loss should be on opposite side of entry from take profit.', 'error');
        return;
      }
      
      // Determine trade direction
      const isLong = take > entry && entry > stop;
      const isShort = stop > entry && entry > take;
      
      if (!isLong && !isShort) {
        showStatus('Invalid trade setup. Entry should be between stop loss and take profit.', 'error');
        return;
      }
      
      // Calculate pips (for EUR/USD, 1 pip = 0.0001)
      const pipsStop = Math.abs(entry - stop) / 0.0001;
      const pipsTake = Math.abs(entry - take) / 0.0001;
      const rrRatio = pipsTake / pipsStop;
      const riskUsd = balance * (riskPct / 100);
      
      // Calculate position size
      let lots = riskUsd / (pipsStop * pipValPerLot);
      lots = Math.max(Math.min(lots, 100), 0.01); // Limit between 0.01 and 100 lots
      
      const units = lots * 100000;
      
      // Update results display
      document.getElementById('pipsStop').textContent = pipsStop.toFixed(1);
      document.getElementById('pipsTake').textContent = pipsTake.toFixed(1);
      document.getElementById('rr').textContent = rrRatio.toFixed(2);
      document.getElementById('riskUsd').textContent = '$' + riskUsd.toFixed(2);
      document.getElementById('lots').textContent = lots.toFixed(3);
      document.getElementById('units').textContent = Math.round(units).toLocaleString();
      
      // Update trade direction indicators
      updateTradeDirectionDisplay(isLong, pipsStop, pipsTake, entry, stop, take);
      
      // Show results
      document.getElementById('result').classList.add('show');
      
      // Analyze trade
      analyzeTrade(pipsStop, rrRatio, riskPct, lots, isLong);
    }

    function updateTradeDirectionDisplay(isLong, pipsStop, pipsTake, entry, stop, take) {
      const tradeDirection = document.getElementById('tradeDirection');
      const directionValue = document.getElementById('directionValue');
      const directionDetails = document.getElementById('directionDetails');
      const tradeIcon = document.getElementById('tradeIcon');
      const tradeType = document.getElementById('tradeType');
      const directionBadge = document.getElementById('directionBadge');
      const directionIndicator = document.getElementById('directionIndicator');
      const directionText = document.getElementById('directionText');
      const directionExplanation = document.getElementById('directionExplanation');
      const pipArrows = document.getElementById('pipArrows');
      const profitArrow = document.getElementById('profitArrow');
      const lossArrow = document.getElementById('lossArrow');
      const profitPips = document.getElementById('profitPips');
      const lossPips = document.getElementById('lossPips');
      const stopHint = document.getElementById('stopHint');
      const takeHint = document.getElementById('takeHint');
      
      if (isLong) {
        // LONG TRADE indicators
        directionValue.textContent = 'LONG (BUY)';
        directionValue.className = 'trade-direction-value long';
        directionDetails.textContent = `Buy at ${entry.toFixed(5)}, target ${take.toFixed(5)}, stop at ${stop.toFixed(5)}`;
        
        tradeIcon.textContent = 'ðŸ“ˆ';
        tradeIcon.className = 'trade-icon long';
        tradeType.textContent = 'Buy Position';
        tradeType.style.color = 'var(--ai-buy)';
        
        directionBadge.textContent = 'LONG TRADE';
        directionBadge.className = 'direction-badge long';
        directionBadge.style.display = 'inline-flex';
        
        directionText.innerHTML = `<span style="color: var(--ai-buy);">BUY at ${entry.toFixed(5)}</span><br>
                                  Target: <span style="color: var(--accent);">${take.toFixed(5)} (+${pipsTake.toFixed(1)} pips)</span><br>
                                  Stop: <span style="color: var(--danger);">${stop.toFixed(5)} (-${pipsStop.toFixed(1)} pips)</span>`;
        directionExplanation.textContent = 'Buy low, sell high strategy';
        
        // Pip arrows for LONG
        profitArrow.textContent = 'â†‘';
        profitArrow.className = 'arrow up';
        lossArrow.textContent = 'â†“';
        lossArrow.className = 'arrow down';
        profitPips.textContent = `+${pipsTake.toFixed(1)}`;
        lossPips.textContent = `-${pipsStop.toFixed(1)}`;
        
        // Update hints
        stopHint.textContent = `Stop below entry by ${pipsStop.toFixed(1)} pips`;
        takeHint.textContent = `Target above entry by ${pipsTake.toFixed(1)} pips`;
        
      } else {
        // SHORT TRADE indicators
        directionValue.textContent = 'SHORT (SELL)';
        directionValue.className = 'trade-direction-value short';
        directionDetails.textContent = `Sell at ${entry.toFixed(5)}, target ${take.toFixed(5)}, stop at ${stop.toFixed(5)}`;
        
        tradeIcon.textContent = 'ðŸ“‰';
        tradeIcon.className = 'trade-icon short';
        tradeType.textContent = 'Sell Position';
        tradeType.style.color = 'var(--ai-sell)';
        
        directionBadge.textContent = 'SHORT TRADE';
        directionBadge.className = 'direction-badge short';
        directionBadge.style.display = 'inline-flex';
        
        directionText.innerHTML = `<span style="color: var(--ai-sell);">SELL at ${entry.toFixed(5)}</span><br>
                                  Target: <span style="color: var(--accent);">${take.toFixed(5)} (+${pipsTake.toFixed(1)} pips)</span><br>
                                  Stop: <span style="color: var(--danger);">${stop.toFixed(5)} (-${pipsStop.toFixed(1)} pips)</span>`;
        directionExplanation.textContent = 'Sell high, buy back low strategy';
        
        // Pip arrows for SHORT (reversed since profit is down, stop is up)
        profitArrow.textContent = 'â†“';
        profitArrow.className = 'arrow down';
        lossArrow.textContent = 'â†‘';
        lossArrow.className = 'arrow up';
        profitPips.textContent = `+${pipsTake.toFixed(1)}`;
        lossPips.textContent = `-${pipsStop.toFixed(1)}`;
        
        // Update hints
        stopHint.textContent = `Stop above entry by ${pipsStop.toFixed(1)} pips`;
        takeHint.textContent = `Target below entry by ${pipsTake.toFixed(1)} pips`;
      }
      
      // Show all direction indicators
      tradeDirection.style.display = 'flex';
      directionIndicator.style.display = 'block';
      pipArrows.style.display = 'flex';
    }

    function analyzeTrade(pipsStop, rrRatio, riskPct, lots, isLong) {
      let message = '';
      let type = 'success';

      const minPips = 3;
      const maxPips = 30;

      // Add direction info to message
      const direction = isLong ? 'LONG' : 'SHORT';
      message = `${direction} trade setup for EUR/USD. `;

      if (pipsStop < minPips) {
        message += `âš ï¸ Stop loss is very tight (under ${minPips} pips). Consider spread impact. `;
        type = 'warning';
      } else if (pipsStop > maxPips) {
        message += `âš ï¸ Stop loss is wide (over ${maxPips} pips). This may not be scalping. `;
        type = 'warning';
      } else if (rrRatio < 1) {
        message += 'âš ï¸ Risk:Reward is below 1:1. Consider adjusting your targets. ';
        type = 'warning';
      } else if (rrRatio >= 1.5) {
        message += `âœ… Good risk:reward ratio! `;
        type = 'success';
      } else {
        message += `ðŸ“ˆ Setup is acceptable. `;
        type = 'success';
      }

      if (riskPct > 2) {
        message += 'Risk percentage is high for scalping. ';
        type = 'warning';
      }

      const maxLotsForCurrency = 50;
      if (lots > maxLotsForCurrency) {
        message += `Position size is large - ensure sufficient margin. `;
        type = 'warning';
      }

      showStatus(message, type);
    }

    function resetCalculator() {
      document.getElementById('entry').value = '';
      document.getElementById('stop').value = '';
      document.getElementById('take').value = '';
      document.getElementById('balance').value = '';
      document.getElementById('riskPct').value = '0.5';
      document.getElementById('pipValue').value = '10';
      
      // Reset results
      document.getElementById('result').classList.remove('show');
      document.getElementById('tradeDirection').style.display = 'none';
      document.getElementById('directionBadge').style.display = 'none';
      document.getElementById('directionIndicator').style.display = 'none';
      document.getElementById('pipArrows').style.display = 'none';
      document.getElementById('tradeIcon').textContent = 'â€”';
      document.getElementById('tradeType').textContent = 'No Trade Calculated';
      document.getElementById('tradeType').style.color = '';
      
      document.getElementById('status').className = 'status';
      showStatus('Calculator reset. Enter new values to calculate.', 'info');
    }

    function syncWithChart() {
      document.getElementById('entry').value = '1.14996';
      document.getElementById('stop').value = '1.14774';
      document.getElementById('take').value = '1.14999';
      calculatePosition();
      showStatus('âœ… Prices synced from chart!', 'success');
    }

    function syncWithMarketData() {
      document.getElementById('entry').value = '1.14996';
      document.getElementById('stop').value = '1.14774';
      document.getElementById('take').value = '1.14999';
      calculatePosition();
      showStatus('âœ… Prices synced with market data!', 'success');
    }

    // AI Assistant Functions
    function initializeAIAssistant() {
      // Mode toggles
      document.getElementById('noHallucinationMode').addEventListener('change', function(e) {
        const badge = this.parentElement.querySelector('.mode-badge');
        badge.textContent = this.checked ? 'ACTIVE' : 'INACTIVE';
        badge.className = this.checked ? 'mode-badge active' : 'mode-badge';
      });
      
      document.getElementById('backtestMode').addEventListener('change', function(e) {
        const badge = this.parentElement.querySelector('.mode-badge');
        badge.textContent = this.checked ? 'ACTIVE' : 'INACTIVE';
        badge.className = this.checked ? 'mode-badge active' : 'mode-badge';
      });
      
      // Symbol select
      document.getElementById('aiSymbolSelect').addEventListener('change', function(e) {
        const symbol = e.target.value;
        selectCurrency(symbol);
        refreshAIInterfaceData();
      });
      
      // Risk parameter inputs
      document.getElementById('aiAccountBalance').addEventListener('input', updateMaxDollarRisk);
      document.getElementById('aiRiskPercent').addEventListener('input', updateMaxDollarRisk);
      document.getElementById('confidenceThreshold').addEventListener('input', function(e) {
        document.getElementById('thresholdValue').textContent = e.target.value;
      });
      
      // Generate signal button
      document.getElementById('generateSignalBtn').addEventListener('click', generateAISignal);
      
      // Apply signal button
      document.getElementById('applySignalBtn').addEventListener('click', applyAISignal);
      
      // Initial updates
      updateMaxDollarRisk();
      initializeValidationGrid();
    }

    function updateAIInterface() {
      refreshAIInterfaceData();
    }

    function refreshAIInterfaceData() {
      // Simulate API data refresh
      const symbol = document.getElementById('aiSymbolSelect').value;
      const currentPrice = getRandomPrice(symbol);
      
      document.getElementById('apiCurrentPrice').textContent = currentPrice.toFixed(5);
      document.getElementById('apiBidAsk').textContent = `${(currentPrice - 0.00005).toFixed(5)} / ${(currentPrice + 0.00005).toFixed(5)}`;
      
      // Update last update time
      updateLastUpdateTime();
      
      // Update validation
      runDataValidation();
    }

    function updateMaxDollarRisk() {
      const balance = parseFloat(document.getElementById('aiAccountBalance').value) || 0;
      const riskPercent = parseFloat(document.getElementById('aiRiskPercent').value) || 0;
      const maxRisk = balance * (riskPercent / 100);
      
      document.getElementById('maxDollarRisk').textContent = `$${maxRisk.toFixed(2)}`;
    }

    function initializeValidationGrid() {
      const validationGrid = document.getElementById('validationGrid');
      const validations = [
        { id: 'priceValid', label: 'Price Data Valid', valid: true },
        { id: 'spreadValid', label: 'Spread Acceptable', valid: true },
        { id: 'indicatorsValid', label: 'Indicators Loaded', valid: true },
        { id: 'noNewsRisk', label: 'No High News Risk', valid: true },
        { id: 'marketOpen', label: 'Market Open', valid: true },
        { id: 'dataFresh', label: 'Data Freshness', valid: true }
      ];
      
      validationGrid.innerHTML = '';
      
      validations.forEach(validation => {
        const div = document.createElement('div');
        div.className = 'validation-item';
        div.id = validation.id;
        div.innerHTML = `
          <span class="validation-icon ${validation.valid ? 'valid' : 'invalid'}">${validation.valid ? 'âœ“' : 'âœ—'}</span>
          <span class="validation-text">${validation.label}</span>
        `;
        validationGrid.appendChild(div);
      });
    }

    function runDataValidation() {
      // Simulate validation checks
      const checks = ['priceValid', 'spreadValid', 'indicatorsValid', 'noNewsRisk', 'marketOpen', 'dataFresh'];
      let passedCount = 0;
      
      checks.forEach(checkId => {
        const isValid = Math.random() > 0.3; // 70% chance of being valid
        const element = document.getElementById(checkId);
        if (element) {
          const icon = element.querySelector('.validation-icon');
          icon.textContent = isValid ? 'âœ“' : 'âœ—';
          icon.className = `validation-icon ${isValid ? 'valid' : 'invalid'}`;
          if (isValid) passedCount++;
        }
      });
      
      const validationStatus = document.getElementById('validationStatus');
      const status = passedCount === checks.length ? 'PASSED' : (passedCount >= checks.length / 2 ? 'PENDING' : 'FAILED');
      validationStatus.textContent = status;
      validationStatus.dataset.status = status;
      
      // Update data status
      document.getElementById('validDataStatus').textContent = passedCount === checks.length ? 'YES' : 'NO';
      document.getElementById('dataTypeStatus').textContent = 'LIVE';
      document.getElementById('dataStatus').style.display = 'block';
    }

    function generateAISignal() {
      if (isGeneratingSignal) return;
      
      isGeneratingSignal = true;
      const btn = document.getElementById('generateSignalBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> Analyzing Market...';
      
      // Simulate AI processing
      setTimeout(() => {
        isGeneratingSignal = false;
        btn.disabled = false;
        btn.innerHTML = '<span>âš¡ Generate AI Signal</span>';
        
        // Generate random signal
        const signalTypes = ['BUY', 'SELL', 'NO_TRADE'];
        const signalType = signalTypes[Math.floor(Math.random() * signalTypes.length)];
        const confidence = Math.floor(Math.random() * 30) + 70; // 70-100%
        
        displayAISignal(signalType, confidence);
        showAIStatus('AI signal generated successfully!', 'success');
        
        // Update confidence meter
        updateConfidenceMeter(confidence);
      }, 2000);
    }

    function displayAISignal(signalType, confidence) {
      const aiSignal = document.getElementById('aiSignal');
      const aiResults = document.getElementById('aiResults');
      const rejectionReasons = document.getElementById('rejectionReasons');
      
      // Reset displays
      aiSignal.className = 'ai-signal';
      aiResults.style.display = 'none';
      rejectionReasons.style.display = 'none';
      
      // Generate trade data
      const entry = 1.15001;
      const stopLoss = 1.14774;
      const takeProfit = 1.15451;
      const stopLossPips = Math.abs(entry - stopLoss) / 0.0001;
      const takeProfitPips = Math.abs(entry - takeProfit) / 0.0001;
      const riskReward = (takeProfitPips / stopLossPips).toFixed(2);
      
      if (signalType === 'NO_TRADE') {
        aiSignal.className = 'ai-signal no-trade';
        document.getElementById('signalIcon').textContent = 'â›”';
        document.getElementById('signalTitle').textContent = 'NO TRADE SIGNAL';
        document.getElementById('signalTitle').className = 'signal-title signal-neutral';
        document.getElementById('signalSubtitle').textContent = 'Market conditions not favorable';
        document.getElementById('signalConfidence').textContent = `${confidence}%`;
        
        // Show rejection reasons
        const reasons = [
          'Spread too wide for scalping',
          'Low R:R ratio potential',
          'Market volatility too high',
          'No clear trend direction',
          'Key resistance/support too close'
        ];
        
        const rejectionList = document.getElementById('rejectionList');
        rejectionList.innerHTML = '';
        reasons.forEach(reason => {
          const li = document.createElement('li');
          li.textContent = reason;
          rejectionList.appendChild(li);
        });
        
        rejectionReasons.style.display = 'block';
      } else {
        const isBuy = signalType === 'BUY';
        aiSignal.className = isBuy ? 'ai-signal buy' : 'ai-signal sell';
        document.getElementById('signalIcon').textContent = isBuy ? 'ðŸ“ˆ' : 'ðŸ“‰';
        document.getElementById('signalTitle').textContent = `${signalType} SIGNAL`;
        document.getElementById('signalTitle').className = isBuy ? 'signal-title signal-buy' : 'signal-title signal-sell';
        document.getElementById('signalSubtitle').textContent = isBuy ? 'Strong bullish momentum detected' : 'Strong bearish momentum detected';
        document.getElementById('signalConfidence').textContent = `${confidence}%`;
        
        // Update results
        document.getElementById('aiEntryPrice').textContent = entry.toFixed(5);
        document.getElementById('aiStopLoss').textContent = stopLoss.toFixed(5);
        document.getElementById('aiTakeProfit').textContent = takeProfit.toFixed(5);
        document.getElementById('aiRiskReward').textContent = `1:${riskReward}`;
        document.getElementById('aiStopLossPips').textContent = stopLossPips.toFixed(1);
        document.getElementById('aiTakeProfitPips').textContent = takeProfitPips.toFixed(1);
        document.getElementById('aiPositionSize').textContent = '0.85';
        document.getElementById('aiDollarRisk').textContent = '$42.50';
        document.getElementById('resultsConfidence').textContent = `${confidence}%`;
        
        // Update apply button
        const applyBtn = document.getElementById('applySignalBtn');
        applyBtn.className = isBuy ? 'apply-signal-btn' : 'apply-signal-btn sell';
        applyBtn.innerHTML = `<span>ðŸ“‹ Apply ${signalType} Signal</span>`;
        
        aiResults.style.display = 'block';
      }
    }

    function updateConfidenceMeter(confidence) {
      const confidenceFill = document.getElementById('confidenceFill');
      const confidenceValue = document.getElementById('confidenceValue');
      
      confidenceFill.style.width = `${confidence}%`;
      confidenceValue.textContent = `${confidence}%`;
      
      // Show breakdown
      const breakdown = document.getElementById('confidenceBreakdown');
      breakdown.style.display = 'block';
      
      // Update breakdown scores
      const scores = ['scoreEMA', 'scoreStructure', 'scoreRSI', 'scorePullback', 'scoreSpread', 'scoreRR', 'scoreMTF', 'scoreSession'];
      scores.forEach(scoreId => {
        const element = document.getElementById(scoreId);
        if (element) {
          const score = Math.floor(Math.random() * 15) + 5; // 5-20 points
          element.textContent = score;
        }
      });
    }

    function applyAISignal() {
      const signalTitle = document.getElementById('signalTitle').textContent;
      
      if (signalTitle.includes('BUY')) {
        document.getElementById('entry').value = '1.15001';
        document.getElementById('stop').value = '1.14774';
        document.getElementById('take').value = '1.15451';
      } else if (signalTitle.includes('SELL')) {
        document.getElementById('entry').value = '1.15001';
        document.getElementById('stop').value = '1.15228';
        document.getElementById('take').value = '1.14551';
      }
      
      calculatePosition();
      showAIStatus(`âœ… ${signalTitle.split(' ')[0]} signal applied to calculator!`, 'success');
    }

    // Market Data Functions
    function initializeMarketData() {
      // Refresh all data button
      document.getElementById('refreshAllData').addEventListener('click', refreshMarketData);
      
      // Auto refresh toggle
      document.getElementById('autoRefreshToggle').addEventListener('click', toggleAutoRefresh);
    }

    function refreshMarketData() {
      const symbol = document.querySelector('[data-api-symbol].active')?.dataset.apiSymbol || 'EURUSD';
      refreshMarketDataForSymbol(symbol);
      showStatus('Market data refreshed!', 'success');
    }

    function refreshMarketDataForSymbol(symbol) {
      // Simulate API data
      const basePrice = getRandomPrice(symbol);
      const changePercent = (Math.random() - 0.5) * 0.1; // -0.05% to +0.05%
      const changeAmount = basePrice * changePercent / 100;
      
      // Update market data
      document.getElementById('marketCurrentPrice').textContent = basePrice.toFixed(5);
      document.getElementById('marketOpen').textContent = (basePrice - changeAmount).toFixed(5);
      document.getElementById('marketHigh').textContent = (basePrice + Math.abs(changeAmount) * 2).toFixed(5);
      document.getElementById('marketLow').textContent = (basePrice - Math.abs(changeAmount) * 2).toFixed(5);
      document.getElementById('marketPreviousClose').textContent = (basePrice - changeAmount).toFixed(5);
      
      // Update change display
      const changeElement = document.getElementById('marketChangePercent');
      const changeClass = changePercent >= 0 ? 'positive' : 'negative';
      changeElement.textContent = `${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%`;
      changeElement.className = `api-data-change ${changeClass}`;
      
      // Update sentiment
      updateMarketSentiment(changePercent);
    }

    function updateMarketSentiment(changePercent) {
      const sentimentBar = document.getElementById('sentimentBar');
      const sentimentText = document.getElementById('sentimentText');
      
      let sentiment;
      let width;
      
      if (changePercent > 0.03) {
        sentiment = 'Very Bullish';
        width = 85;
      } else if (changePercent > 0.01) {
        sentiment = 'Bullish';
        width = 65;
      } else if (changePercent > -0.01) {
        sentiment = 'Neutral';
        width = 50;
      } else if (changePercent > -0.03) {
        sentiment = 'Bearish';
        width = 35;
      } else {
        sentiment = 'Very Bearish';
        width = 15;
      }
      
      sentimentBar.style.width = `${width}%`;
      sentimentText.textContent = sentiment;
      sentimentText.style.color = width > 50 ? 'var(--accent)' : (width < 50 ? 'var(--danger)' : 'var(--warning)');
    }

    function toggleAutoRefresh() {
      const btn = document.getElementById('autoRefreshToggle');
      isAutoRefreshEnabled = !isAutoRefreshEnabled;
      
      if (isAutoRefreshEnabled) {
        btn.innerHTML = '<span>â±ï¸ Auto Refresh: ON</span>';
        btn.style.background = 'var(--accent)';
        autoRefreshInterval = setInterval(refreshMarketData, 5000); // Refresh every 5 seconds
      } else {
        btn.innerHTML = '<span>â±ï¸ Auto Refresh: OFF</span>';
        btn.style.background = 'var(--api-blue)';
        clearInterval(autoRefreshInterval);
      }
    }

    // Chart Functions
    function initializeChart() {
      // Timeframe buttons
      document.querySelectorAll('.timeframe-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          document.querySelectorAll('.timeframe-btn').forEach(b => {
            b.classList.remove('active');
          });
          e.target.classList.add('active');
          updateChartTimeframe(e.target.dataset.timeframe);
        });
      });
      
      // Chart type buttons
      document.querySelectorAll('.chart-type-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          document.querySelectorAll('.chart-type-btn').forEach(b => {
            b.classList.remove('active');
          });
          e.target.classList.add('active');
        });
      });
      
      // Quick actions
      document.getElementById('quickEntry').addEventListener('click', function() {
        document.getElementById('entry').value = '1.14996';
        calculatePosition();
      });
      
      document.getElementById('quickStop').addEventListener('click', function() {
        document.getElementById('stop').value = '1.14774';
        calculatePosition();
      });
      
      document.getElementById('quickTake').addEventListener('click', function() {
        document.getElementById('take').value = '1.14999';
        calculatePosition();
      });
      
      document.getElementById('updateFromMarket').addEventListener('click', function() {
        document.getElementById('entry').value = '1.14996';
        document.getElementById('stop').value = '1.14774';
        document.getElementById('take').value = '1.14999';
        calculatePosition();
      });
      
      // Initialize TradingView chart
      initializeTradingViewChart();
    }

    function initializeTradingViewChart() {
      setTimeout(function() {
        if (window.TradingView) {
          new TradingView.widget({
            "container_id": "tradingview_chart",
            "width": "100%",
            "height": "400",
            "symbol": "FX:EURUSD",
            "interval": "5",
            "timezone": "Etc/UTC",
            "theme": document.body.getAttribute('data-theme') === 'dark' ? 'dark' : 'light',
            "style": "1",
            "locale": "en",
            "toolbar_bg": document.body.getAttribute('data-theme') === 'dark' ? '#111827' : '#ffffff',
            "enable_publishing": false,
            "allow_symbol_change": false,
            "hide_side_toolbar": true,
            "save_image": false,
            "studies": [
              "MAWeighted@tv-basicstudies"
            ],
            "show_popup_button": true,
            "popup_width": "1000",
            "popup_height": "650",
            "disabled_features": ["use_localstorage_for_settings"],
            "enabled_features": ["study_templates"]
          });
        }
      }, 1000);
    }

    function updateChartTheme() {
      // This would ideally reload the chart with new theme
      // For now, we'll just show a notice
      showStatus('Please refresh the page to see chart theme changes', 'info');
    }

    function updateChartSymbol(symbol) {
      // Update chart display
      const chartSymbols = {
        EURUSD: 'FX:EURUSD',
        GBPUSD: 'FX:GBPUSD',
        USDJPY: 'FX:USDJPY',
        AUDUSD: 'FX:AUDUSD',
        USDCAD: 'FX:USDCAD',
        USDCHF: 'FX:USDCHF',
        XAUUSD: 'FOREXCOM:XAUUSD'
      };
      
      const tvSymbol = chartSymbols[symbol] || 'FX:EURUSD';
      document.getElementById('currentPrice').textContent = `${symbol}: 1.14996`;
      
      // In a real app, you would update the TradingView widget here
    }

    function updateChartTimeframe(timeframe) {
      // Update chart timeframe
      // In a real app, you would update the TradingView widget here
    }

    // Utility Functions
    function setupEventListeners() {
      // Window resize handling
      window.addEventListener('resize', handleResize);
    }

    function handleResize() {
      // Adjust layout on resize
      // This is where you could add more responsive behavior if needed
    }

    function updateLastUpdateTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
      document.getElementById('lastUpdateTime').textContent = timeString;
    }

    function getRandomPrice(symbol) {
      const basePrices = {
        EURUSD: 1.14996,
        GBPUSD: 1.27456,
        USDJPY: 147.892,
        AUDUSD: 0.65892,
        USDCAD: 1.34987,
        USDCHF: 0.88456,
        XAUUSD: 2025.67
      };
      
      const base = basePrices[symbol] || 1.14996;
      const variation = (Math.random() - 0.5) * 0.001; // Small random variation
      return base + variation;
    }

    function showStatus(message, type = 'error') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status show ${type}`;
      
      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          status.className = 'status';
        }, 5000);
      }
    }
    
    function showAIStatus(message, type = 'info') {
      const status = document.getElementById('aiStatus');
      status.textContent = message;
      status.className = `ai-status ${type}`;
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        status.className = 'ai-status';
      }, 5000);
    }
  </script>
</body>
</html>
